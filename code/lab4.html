<html>

<script id="vertex-shader" type="x-shader/x-vertex">

precision mediump float;

attribute vec4 vPosition;
attribute vec4 vNormal;
attribute vec2 vTexCoord;

varying vec4 fColor;
uniform float shading;
varying float fshading;
uniform float vtexture;
varying float ftexture;

uniform vec4 glow;
varying vec4 fglow;
varying vec2 fTexCoord;

uniform float angle, falloff;
uniform vec4 lightDirection;
uniform vec4 ambientProduct, diffuseProduct, specularProduct;
uniform mat4 modelView;
uniform mat4 vprojection;
uniform vec4 lightPosition;
uniform float shininess;
varying vec3 N, L, E, D;
varying float fAngle, fFalloff;
varying vec3 pos, light, dir;

void
main()
{
	fAngle=angle;
	fFalloff=falloff;
    fTexCoord = vTexCoord;
	fglow=glow;
	fshading=shading;
	ftexture=vtexture;

	pos = (modelView * vPosition).xyz;
   	light = lightPosition.xyz;
	dir = lightDirection.xyz;
	D = normalize( dir - light );
    L = normalize( pos - light );
    E = normalize( pos );
    N = normalize( (modelView*vNormal).xyz);
	float A = dot(D, L);

    gl_Position = vprojection * modelView * vPosition;
    
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">

precision mediump float;

varying vec4 fColor;
varying float fshading;
varying float ftexture;

uniform vec4 ambientProduct;
uniform vec4 diffuseProduct;
uniform vec4 specularProduct;
uniform float shininess;
varying vec3 N, L, E, D;
varying vec3 pos, light, dir;

varying vec4 fglow;
varying vec2 fTexCoord;
varying float fAngle, fFalloff;

uniform sampler2D texture;

void
main()
{
	vec3 D = normalize( dir - light );
    vec3 L = normalize( pos - light );
	float A = dot(D, L);

	vec4 color=fColor;
	if (fshading==1.0){
	    vec3 H = normalize( L + E );
	    vec4 ambient = ambientProduct;

    	float Kd = max( dot(L, N), 0.0 );
	    vec4  diffuse = Kd*diffuseProduct;

    	float Ks = pow( max(dot(N, H), 0.0), shininess );
	    vec4  specular = Ks * specularProduct;
    
    	if( dot(L, N) < 0.0 ) specular = vec4(0.0, 0.0, 0.0, 1.0);

	    color = ambient + diffuse +specular;
    	color.a = 1.0;
	} else {
		color=ambientProduct+diffuseProduct+specularProduct;
	}

	if (ftexture==1.0){
		color=color*texture2D( texture, fTexCoord );
	}
	if (A<cos(fAngle*3.14/180.0)){
		color = color/(.05*((fAngle+fFalloff)-acos(A)));
	}
	if (A<(cos((fAngle+fFalloff)*3.14/180.0))){
		color = vec4(0, 0, 0, 1.0);
	}

	color=color+fglow;

    gl_FragColor = color;

}
</script>

<script type="text/javascript" src="Common/webgl-utils.js"></script>
<script type="text/javascript" src="Common/initShaders.js"></script>
<script type="text/javascript" src="Common/MV.js"></script>
<script type="text/javascript" src="lab4.js"></script>

<body>
<canvas id="gl-canvas" width="512"" height="512">
Oops ... your browser doesn't support the HTML5 canvas element
</canvas>

<img id = "texImage" src = "I90042.jpeg" width="0"></img>
<img id = "myFace" src = "IMG_2903.jpg" width="0"></img>
<img id = "face1" src = "IMG_2844.JPG" width="0"></img>
<img id = "face2" src = "IMG_2044.jpg" width="0"></img>
   
<br/>

<div> Speed: <input id="speed" type="range"
	min="0.0" max="6.0" step="1.0" value="0" />
</div>
<div> Rotate: <input id="rotate" type="range"
	min="0.0" max="360.0" step="10.0" value="0" />
</div>

<div> Lookat: <input id="lookatX" type="range"
	min="-5.0" max="5.0" step="1.0" value="0" />
	<input id="lookatY" type="range"
	min="-1.0" max="3.0" step="1.0" value="0" />
	<input id="lookatZ" type="range"
	min="-10.0" max="10.0" step="1.0" value="2" />
</div>
<div> Eye-point: <input id="eyeX" type="range"
	min="-10.0" max="10.0" step="1.0" value="0" />
	<input id="eyeY" type="range"
	min="-10.0" max="0.0" step="1.0" value="-1" />
	<input id="eyeZ" type="range"
	min="-30.0" max="30.0" step="1.0" value="0" />
</div>

<br/>

<div> Light Position: <input id="lPosX" type="range"
	min="-50.0" max="50.0" step="1.0" value="1" />
	<input id="lPosY" type="range"
	min="-50.0" max="50.0" step="1.0" value="1" />
	<input id="lPosZ" type="range"
	min="-70.0" max="70.0" step="1.0" value="1" />
</div>
<div> Light Direction: <input id="lDirX" type="range"
	min="-10.0" max="10.0" step="1.0" value="0" />
	<input id="lDirY" type="range"
	min="-10.0" max="0.0" step="1.0" value="0" />
	<input id="lDirZ" type="range"
	min="-30.0" max="30.0" step="1.0" value="0" />
</div>
<div> Light Angle: <input id="angle" type="range"
	min="0.0" max="180.0" step="1.0" value="60" />
	Fall off: <input id="falloff" type="range"
	min="0.0" max="50.0" step="1.0" value="10" />
</div>

<div>
Texturing: <input id="shade" type="radio"
	name="texture" value="shade"> Shading </input>
	<input id="texture" type="radio"
	name="texture" value="texture"> Texturing </input>
	<input id="both" type="radio"
	name="texture" value="both" checked> Both </input>
</div>

</body>
</html>
