<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Russian Noun Declensions</title>  
    <style>
      td {border:1px solid black; margin: 0; padding: 0;}
      body { margin: 0; padding: 0; font-size:30px;}
      rt {font-size:18px;color:#666;vertical-align:top;}
      input {height: 22px;}
      a {color:gray; text-decoration: underline; padding-bottom:0;}
      .container { margin: 0 auto; max-width: 960px; width:80%;}
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script>
      class Problem {
        constructor(russian_sentence, english_translation, word, answer, explanation, animate, group, answer_declension, dcase, number) {
          this.russian_sentence = russian_sentence;
          this.english_translation = english_translation;
          this.word = word;
          this.answer = answer;
          this.explanation = explanation;
          this.animate = animate;
          this.group = group;
          this.answer_declension = answer_declension;
          this.dcase = dcase;
          this.number = number;
        }
      }

      var russian_problem;
      var problemSet;

      $(function(){
        //$("#headerFile").load("_header.html");
        var fileContents = readFile();
        convertToProblems(fileContents);
          
        resetProblem();
      });

      function collapseHeader() {
        var collapsibles = document.getElementsByClassName("collapsible");

        var content = collapsibles[0];
       if (content.style.display === "block") {
          content.style.display = "none";
        } else {
          content.style.display = "block";
        }
      }

      function readFile() {
        var reader = new XMLHttpRequest();
        reader.open("GET", "sentences.tsv", false);
        reader.send();
        if (reader.status==200) {
          result = reader.responseText;
        }
        return result
      }

      function convertToProblems(fileContents) {
        var objects = fileContents.split('\n');
        problemSet = new Array(objects.length - 1);
        for (var i=1; i<objects.length; i++) {
          var data = objects[i].split('\t');
          var problem = new Problem(data[0], data[1], data[2], data[3], data[4], data[5], data[6], data[7], data[8], data[9]);
          problemSet[i -1] = problem;
        }
      }

      function resetProblem() {
        var filteredProblems = problemSet.filter(checkNumber).filter(checkCase).filter(checkGroup);
        //alert(filteredProblems.length)
        var newProblemIndex = Math.floor(Math.random() * filteredProblems.length);
        russian_problem = filteredProblems[newProblemIndex];

        var inputStart = "<ruby><form action='javascript:;' onsubmit='checkWork()'><input autocomplete='off' type='text' id='entry' tabindex='-1'></input></form><rt>";
        var inputEnd = "</rt></ruby>"
        var input = inputStart + russian_problem.word + inputEnd;

        var sentence = russian_problem.russian_sentence.replace("___", input);
        var hintButton = "<button id='hintButton' onclick='giveHint()'>Hint</button>"
        var spacer = "<span style='width: 5px; display: inline-block;'></span>"

        var problemDiv = document.getElementById("problem");
        problemDiv.innerHTML = sentence+spacer+hintButton;

        var translationDiv = document.getElementById("translation");
        translationDiv.innerHTML = russian_problem.english_translation;

        var feedbackBox = document.getElementById("feedback");
        feedbackBox.style = "text-align:left;";
        feedbackBox.innerHTML = "";

        var hintbox = document.getElementById("hint");
        hintbox.style = "text-align:left;";
        hintbox.innerHTML = "";

        document.getElementById("entry").focus();
      }

      function checkNumber(problem) {
        var singularOkay = document.getElementById("sing").checked; 
        var pluralOkay = document.getElementById("plur").checked;
        var singular = singularOkay && problem.number.trim() == "SINGULAR";
        var plural = pluralOkay && problem.number.trim() == "PLURAL";
        return singular || plural;
      }

      function checkCase(problem) {
        var nomOkay = document.getElementById("nom").checked; 
        var accOkay = document.getElementById("acc").checked;
        var genOkay = document.getElementById("gen").checked; 
        var datOkay = document.getElementById("dat").checked;
        var prepOkay = document.getElementById("prep").checked; 
        var instOkay = document.getElementById("inst").checked;

        var nom = nomOkay && problem.dcase.trim() == "NOMINATIVE";
        var acc = accOkay && problem.dcase.trim() == "ACCUSATIVE";
        var gen = genOkay && problem.dcase.trim() == "GENITIVE";
        var dat = datOkay && problem.dcase.trim() == "DATIVE";
        var prep = prepOkay && problem.dcase.trim() == "PREPOSITIONAL";
        var inst = instOkay && problem.dcase.trim() == "INSTRUMENTAL";
        return nom || acc || gen || dat || prep || inst;
      }

      function checkGroup(problem) {
        var oneOkay = document.getElementById("g1").checked; 
        var twoOkay = document.getElementById("g2").checked;
        var threeOkay = document.getElementById("g3").checked;
        var one = oneOkay && problem.group.trim() == "1";
        var two = twoOkay && problem.group.trim() == "2";
        var three = threeOkay && problem.group.trim() == "3";
        return one || two || three;
      }

      function checkWork() {
        var feedbackBox = document.getElementById("feedback");
        var x = document.getElementById("entry").value.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim();
        if (x == russian_problem.answer.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim()) {
          feedbackBox.style = "background-color:#00DD0010;border-color:#00DD00;border-width:2px;border-style:solid;padding:15px;border-radius:15px"
          feedbackBox.innerHTML = "<p style='color:#00DD00;'><b>Correct!</b></p><p style='color:#00DD00;'>" + russian_problem.explanation + " -- " + russian_problem.answer +"!</p><button style='margin:auto;display:block;' id='newWordButton' onclick='resetProblem();' tabindex='-1'>New Word!</button>"
        } else {
          feedbackBox.style = "background-color:#FF000020;border-color:#FF0000;border-width:2px;border-style:solid;padding:15px;border-radius:15px"
          feedbackBox.innerHTML = "<p style='color:#FF0000;'><b>Incorrect!</b></p><p style='color:#FF0000;'>" + russian_problem.explanation + " -- " + russian_problem.answer +"!</p><button style='margin:auto;display:block;' id='newWordButton' onclick='resetProblem();' tabindex='-1'>New Word!</button>"
        }
        document.getElementById("newWordButton").focus();
      }

      function giveHint() {
        var hintbox = document.getElementById("hint");
        hintbox.style = "background-color:#DDDD0010;border-color:#DDDD00;border-width:2px;border-style:solid;padding:5px 15px;border-radius:5px"
        var hintText = "<p>Is this noun in the <a onclick='selectDeclensionGroup(1)' title='Ends with -а or -я'>first</a>, <a onclick='selectDeclensionGroup(2)' title='Ends with -й, a consonant, -е, -о, or masculine -ь'>second</a>, or <a onclick='selectDeclensionGroup(3)' title='Ends with -мя or feminine -ь'>third</a> declension group?</p>"
        
        hintbox.innerHTML = hintText
      }

      function selectDeclensionGroup(x) {
        var group1Table = `<table style='margin:auto' frame=void rules=rows>
          <tbody>
            <tr><td></td><td>Singular</td><td rowspan="7"></td><td>Plural</td></tr>
            <tr><td>Nominative</td><td>-а</td><td>-ы</td></tr>
            <tr><td>Accusative</td><td>-у</td><td><a title='inanimate'>-ы</a>/<a title='animate'>--</a></td></tr>
            <tr><td>Genitive</td><td>-ы</td><td>--</td></tr>
            <tr><td>Dative</td><td>-е</td><td>-ам</td></tr>
            <tr><td>Prepositional</td><td>-е</td><td>-ах</td></tr>
            <tr><td>Instrumental</td><td>-ой</td><td>-ами</td></tr>
          </tbody>
        </table>`
        var group2Table = `<table style='margin:auto' frame=void rules=rows>
          <tbody>
            <tr><td></td><td colspan="2">Singular</td><td rowspan="7"></td><td colspan="2">Plural</td></tr>
            <tr><td>Nominative</td><td>--</td><td>-о</td><td>-ы</td><td>-а</td></tr>
            <tr><td>Accusative</td><td><a title='inanimate'>--</a>/<a title='animate'>-а</a></td><td>-о</td><td><a title='inanimate'>-ы</a>/<a title='animate'>-ов/-ей</a></td><td><a title='inanimate'>-а</a>/<a title='animate'>--</a></td></tr>
            <tr><td>Genitive</td><td>-а</td><td>-а</td><td>-ов/-ей</td><td>--</td></tr>
            <tr><td>Dative</td><td>-у</td><td>-у</td><td>-ам</td><td>-ам</td></tr>
            <tr><td>Prepositional</td><td>-е</td><td>-е</td><td>-ах</td><td>-ах</td></tr>
            <tr><td>Instrumental</td><td>-ом</td><td>-ом</td><td>-ами</td><td>-ами</td></tr>
          </tbody>
        </table>`
        group3Table = `<table style='margin:auto' frame=void rules=rows>
          <tbody>
            <tr><td></td><td>Singular</td><td rowspan="7"></td><td>Plural</td></tr>
            <tr><td>Nominative</td><td>-ь</td><td>-и</td></tr>
            <tr><td>Accusative</td><td>-ь</td><td><a title='inanimate'>-и</a>/<a title='animate'>-ей</a></td></tr>
            <tr><td>Genitive</td><td>-и</td><td>-ей</td></tr>
            <tr><td>Dative</td><td>-и</td><td>-ям</td></tr>
            <tr><td>Prepositional</td><td>-и</td><td>-ях</td></tr>
            <tr><td>Instrumental</td><td>-ью</td><td>-ями</td></tr>
          </tbody>
        </table>`
        var hintbox = document.getElementById("hint");
        hintbox.style = "background-color:#DDDD0010;border-color:#DDDD00;border-width:2px;border-style:solid;padding:15px; border-radius:5px"
        if (x == 1) {
          hintbox.innerHTML = group1Table
        } else if (x == 2) {
          hintbox.innerHTML = group2Table
        } else {
          hintbox.innerHTML = group3Table
        }
      }

      function selectAnimacy(x, animacy) {
        var group1AnimateTable = `<table frame=void rules=rows>
          <tbody>
            <tr><td></td><td>Singular</td><td rowspan="7"></td><td>Plural</td></tr>
            <tr><td>Nominative</td><td>-a</td><td>-ы</td></tr>
            <tr><td>Accusative</td><td>-у</td><td>--</td></tr>
            <tr><td>Genitive</td><td>-ы</td><td>--</td></tr>
            <tr><td>Dative</td><td>-е</td><td>-ам</td></tr>
            <tr><td>Prepositional</td><td>-е</td><td>-ах</td></tr>
            <tr><td>Instrumental</td><td>-oy</td><td>-ами</td></tr>
          </tbody>
        </table>`
         var group1InanimateTable = `<table frame=void rules=rows>
          <tbody>
            <tr><td></td><td>Singular</td><td rowspan="7"></td><td>Plural</td></tr>
            <tr><td>Nominative</td><td>-a</td><td>-ы</td></tr>
            <tr><td>Accusative</td><td>-у</td><td>-ы</td></tr>
            <tr><td>Genitive</td><td>-ы</td><td>--</td></tr>
            <tr><td>Dative</td><td>-е</td><td>-ам</td></tr>
            <tr><td>Prepositional</td><td>-е</td><td>-ах</td></tr>
            <tr><td>Instrumental</td><td>-ой</td><td>-ами</td></tr>
          </tbody>
        </table>`
        var group2AnimateTable = `<table frame=void rules=rows>
          <tbody>
            <tr><td></td><td colspan="2">Singular</td><td rowspan="7"></td><td colspan="2">Plural</td></tr>
            <tr><td>Nominative</td><td>--</td><td>-o</td><td>-ы</td><td>-a</td></tr>
            <tr><td>Accusative</td><td>-a</td><td>-o</td><td>-ov</td><td>--</td></tr>
            <tr><td>Genitive</td><td>-a</td><td>-a</td><td>-ov</td><td>--</td></tr>
            <tr><td>Dative</td><td>-ы</td><td>-ы</td><td>-ам</td><td>-ам</td></tr>
            <tr><td>Prepositional</td><td>-е</td><td>-е</td><td>-ах</td><td>-ах</td></tr>
            <tr><td>Instrumental</td><td>-om</td><td>-om</td><td>-ами</td><td>-ами</td></tr>
          </tbody>
        </table>`
        var group2InanimateTable = `<table frame=void rules=rows>
          <tbody>
            <tr><td></td><td colspan="2">Singular</td><td rowspan="7"></td><td colspan="2">Plural</td></tr>
            <tr><td>Nominative</td><td>--</td><td>-o</td><td>-ы</td><td>-a</td></tr>
            <tr><td>Accusative</td><td>--</td><td>-o</td><td>-ы</td><td>-a</td></tr>
            <tr><td>Genitive</td><td>-a</td><td>-a</td><td>-ov</td><td>--</td></tr>
            <tr><td>Dative</td><td>-ы</td><td>-ы</td><td>-ам</td><td>-ам</td></tr>
            <tr><td>Prepositional</td><td>-е</td><td>-е</td><td>-ах</td><td>-ах</td></tr>
            <tr><td>Instrumental</td><td>-om</td><td>-om</td><td>-ами</td><td>-ами</td></tr>
          </tbody>
        </table>`
        group3AnimateTable = `<table frame=void rules=rows>
          <tbody>
            <tr><td></td><td>Singular</td><td rowspan="7"></td><td>Plural</td></tr>
            <tr><td>Nominative</td><td>-ь</td><td>-и</td></tr>
            <tr><td>Accusative</td><td>-ь</td><td>-ей</td></tr>
            <tr><td>Genitive</td><td>-и</td><td>-ей</td></tr>
            <tr><td>Dative</td><td>-ью</td><td>-ях</td></tr>
            <tr><td>Prepositional</td><td>-и</td><td>-ях</td></tr>
            <tr><td>Instrumental</td><td>-ью</td><td>-ях</td></tr>
          </tbody>
        </table>`
        group3InanimateTable = `<table frame=void rules=rows>
          <tbody>
            <tr><td></td><td>Singular</td><td rowspan="7"></td><td>Plural</td></tr>
            <tr><td>Nominative</td><td>-ь</td><td>-и</td></tr>
            <tr><td>Accusative</td><td>-ь</td><td>-и</td></tr>
            <tr><td>Genitive</td><td>-и</td><td>-ей</td></tr>
            <tr><td>Dative</td><td>-ью</td><td>-ях</td></tr>
            <tr><td>Prepositional</td><td>-и</td><td>-ях</td></tr>
            <tr><td>Instrumental</td><td>-ью</td><td>-ях</td></tr>
          </tbody>
        </table>`
        var hintbox = document.getElementById("hint");
        if (x == 1 && animacy) {
          hintbox.innerHTML = group1AnimateTable
        } else if (x == 1 && !animacy) {
          hintbox.innerHTML = group1InanimateTable
        } else if (x == 2 && animacy) {
          hintbox.innerHTML = group2AnimateTable
        } else if (x == 2 && !animacy) {
          hintbox.innerHTML = group2InanimateTable
        } else if (x == 3 && animacy) {
          hintbox.innerHTML = group3AnimateTable
        }else {
          hintbox.innerHTML = group3InanimateTable
        }
      }
    </script>
  </head>
  <body class='no-header-page wsite-theme-light wsite-page-index'>
    <div id="top-background" style="height:44px;background-color:black;" onclick="collapseHeader()";>
      <img src="settings.png" style="float:right; height:30px; width:30px; margin:7px 10% 7px 5px;"/>
    </div>
    <div id="main-wrap" style="background-color: white;">
      <div class="collapsible" style="border: 1px black; border-style: none solid solid solid; border-radius: 0px 0px 10px 10px; width: 70%;background-color: white; margin: auto; position: relative; z-index: 1; display: none; padding: 10px 5%;">
        <span style="width: 50%; display: inline-block;">
          <input type="checkbox" id="nom" name="nom" value="Nominative" checked />
          <label for="nom"> Nominative / именительный</label><br/>

          <input type="checkbox" id="acc" name="acc" value="Accusative" checked />
          <label for="acc"> Accusative / винительный</label><br/>

          <input type="checkbox" id="gen" name="gen" value="Genitive" checked />
          <label for="gen"> Genitive / родительный</label><br/>

          <input type="checkbox" id="dat" name="dat" value="Dative" checked />
          <label for="dat"> Dative / дательный</label><br/>

          <input type="checkbox" id="prep" name="prep" value="Prepositional" checked />
          <label for="prep"> Prepositional / предложный</label><br/>

          <input type="checkbox" id="inst" name="inst" value="Instrumental" checked />
          <label for="inst"> Instrumental / творительный</label><br/>
        </span>
        <span style="width: 40%; display: inline-block;">
          <input type="checkbox" id="sing" name="sing" value="Singular" checked />
          <label for="sing"> Singular / единственный</label><br/>

          <input type="checkbox" id="plur" name="plur" value="Plural" checked />
          <label for="plur"> Plural / множественный</label><br/>

          <br/>

          <input type="checkbox" id="g1" name="g1" value="Group 1" checked />
          <label for="g1"> Group 1 / I склонение</label><br/>

          <input type="checkbox" id="g2" name="g2" value="Group 2" checked />
          <label for="g2"> Group 2 / II склонение</label><br/>

          <input type="checkbox" id="g3" name="g3" value="Group 3" checked />
          <label for="g3"> Group 3 / III склонение</label><br/>
        </span>
      </div>
      <div class="container" style="height: 500px; background-color: white; position: absolute; top: 60px; left: 0px; right: 0px; margin-inline: auto;">
        <div id="problem" class="paragraph" style="text-align:left;"></div>
        <div id="translation" class="paragraph" style="text-align:left;font-size:24px;color:#666;"></div>
        <br />
        <div style="clear:both"></div>
        <div id="hint" class="paragraph" style="text-align:left;"></div>
        <br />
        <div id="feedback" class="paragraph" style="text-align:left;"></div>
      </div>
    </div>
  </body>
</html>